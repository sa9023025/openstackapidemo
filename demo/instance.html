<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
    <meta name="author" content="GeeksLabs">
    <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
    <link rel="shortcut icon" href="img/favicon.png">

    <title>Creative - Bootstrap Admin Template</title>
    <script src="js/app.js"></script>
    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- bootstrap theme -->
    <link href="css/bootstrap-theme.css" rel="stylesheet">
    <!--external css-->
    <!-- font icon -->
    <link href="css/elegant-icons-style.css" rel="stylesheet"/>
    <link href="css/font-awesome.min.css" rel="stylesheet"/>
    <!-- Custom styles -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet"/>
    <link href="css/jquery-ui-1.10.4.min.css" rel="stylesheet">
    <link href="css/app.css" rel="stylesheet">
    <link href="css/instance.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <script src="js/lte-ie7.js"></script>
    <![endif]-->
</head>

<body>
<!-- container section start -->
<section id="container" class="">


    <header class="header dark-bg">
        <div class="toggle-nav">
            <div class="icon-reorder"><i class="icon_menu"></i></div>
        </div>

        <!--logo start-->
        <a href="index.html" class="logo">Openstack <span class="lite">Demo</span></a>
        <!--logo end-->

        <div class="top-nav notification-row">
            <!-- notificatoin dropdown start-->
            <ul class="nav pull-right top-menu">
                <span id="loginuser" class="username"></span>
                <span><a id="logout" onclick="logout()">登出</a></span>
            </ul>
            <!-- notificatoin dropdown end-->
        </div>
    </header>
    <!--header end-->

    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu">
                <li>
                    <a class="" href="index.html">
                        <i class="icon_house_alt"></i>
                        <span>概況</span>
                    </a>
                </li>
                <li class="active">
                    <a class="" href="instance.html">
                        <i class="icon_desktop"></i>
                        <span>新增主機</span>
                    </a>
                </li>
            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->

    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <!--overview start-->
            <div class="row">
                <div class="col-lg-12">
                    <h3 class="page-header"><i class="fa fa-laptop"></i>新增主機</h3>
                    <ol class="breadcrumb">
                        <li><i class="fa fa-home"></i><a href="index.html">首頁</a></li>
                        <li><i class="fa fa-laptop"></i>新增主機</li>
                    </ol>
                </div>
                <form>
                    <p class="col-lg-12">請提供...相對應的主機名稱、敘述說明...</p>
                    <div class="col-lg-12">
                        <div class="title"><h4>一般</h4></div>
                        <div class="row">
                            <div class="col-lg-12">
                                <h5>名稱</h5>
                                <input type="text" class="form-control" name="name">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <h5>敘述</h5>
                                <input type="text" class="form-control" name="description">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <h5>可用區域</h5>
                                <select class="form-control" name="zoneUse">
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <h5>數量 </h5>
                                <input type="number" class="form-control" name="countInput" min="1" value="1">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <h5>選擇來源</h5>
                                <select class="form-control" name="sourceSelect">
                                </select>
                            </div>
                        </div>
                        
                        <!-- <div class="row collapse" id="volume-collapse">
                            <div class="col-lg-12">
                                <h5>Volume Size (GB)</h5>
                                <input type="number" class="form-control" name="description" min="1" value="1">
                            </div>
                        </div> -->

                        <div class="row">
                            <div class="col-lg-12">
                                <h5>選擇Flavor</h5>
                                <select class="form-control" name="flavorSelect">
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12">
                                <h5>選擇Network</h5>
                                <select class="form-control" name="networkSelect">
                                </select>
                            </div>
                        </div>
                        <br>
                        <!-- <div><h4 class="title">配置</h4></div> -->
                        <!-- <div class="row">
                            <div class="col-lg-12">
                                <table class="table table-striped">
                                    <thead>
                                    <tr>
                                        <th></th>
                                        <th>名稱</th>
                                        <th>更新</th>
                                        <th>空間</th>
                                        <th>種類</th>
                                        <th style="min-width: 5em">能見度</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td><input type="radio" name="spec" min="1" value="1"></td>
                                        <td>Fedora-Atomic-25</td>
                                        <td>11/22/20 2:57 AM</td>
                                        <td>670.13 MB</td>
                                        <td>qcow2</td>
                                        <td>共享</td>
                                    </tr>
                                    <tr>
                                        <td><input type="radio" name="spec" min="1" value="2"></td>
                                        <td>Fedora-Atomic-25</td>
                                        <td>11/22/20 2:57 AM</td>
                                        <td>670.13 MB</td>
                                        <td>qcow2</td>
                                        <td>共享</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div> -->
                        <input type="button" value="儲存" class="btn btn-primary" onclick="confirm()"> 
                    </div>
                </form>
            </div>
            </div>
        </section>
    </section>
    <!--main content end-->
</section>
<!-- container section start -->

<!-- javascripts -->
<script src="js/jquery.js"></script>
<script src="js/jquery-ui-1.10.4.min.js"></script>
<script src="js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.9.2.custom.min.js"></script>
<!-- bootstrap -->
<script src="js/bootstrap.min.js"></script>
<!-- nice scroll -->
<script src="js/jquery.scrollTo.min.js"></script>

<!--custome script for all page-->
<script src="js/scripts.js"></script>
<script src="js/instance.js"></script>
<script>

    $(function(){
        $.ajax({
            type: "GET",
            url: API_URL+"/v2.1/os-availability-zone",
            headers: {"X-Auth-Token" : token,
                      "Content-Type": "application/json",
                      Accept:"application/json"},
            success: function(data) {
                Array.from(data.availabilityZoneInfo).forEach(element => {
                    $("select[name='zoneUse'").append($('<option>', {
                        value: element.zoneName,
                        text: element.zoneName
                    }));
                });
                
            }
        })

        $.ajax({
            type: "GET",
            url: API_URL+"/v2.1/images/detail",
            headers: {"X-Auth-Token" : token,
                      "Content-Type": "application/json",
                      Accept:"application/json"},
            success: function(data) {
                Array.from(data.images).forEach(element => {
                    $("select[name='sourceSelect'").append($('<option>', {
                        value: element.id,
                        text: element.name
                    }));
                });
                
            }
        })

        $.ajax({
            type: "GET",
            url: API_URL+"/v2.1/flavors/detail",
            headers: {"X-Auth-Token" : token,
                      "Content-Type": "application/json",
                      Accept:"application/json"},
            success: function(data) {
                
                Array.from(data.flavors).forEach(element => {
                    $("select[name='flavorSelect'").append($('<option>', {
                        value: element.links[0].href,
                        text: element.name
                    }));
                });
                
            }
        })

        $.ajax({
            type: "GET",
            url: API_URL+"/v2.1/os-tenant-networks",
            headers: {"X-Auth-Token" : token,
                      "Content-Type": "application/json",
                      Accept:"application/json"},
            success: function(data) {
                Array.from(data.networks).forEach(element => {
                    $("select[name='networkSelect'").append($('<option>', {
                        value: element.id,
                        text: element.label
                    }));
                });
                
            }
        })
    })

    function confirm() {
        var data = {
            "server": {
                "name": $("input[name=name]").val(), 
                "imageRef": $("select[name=sourceSelect]").val(), 
                "flavorRef": $("select[name=flavorSelect]").val(), 
                "max_count": $("input[name=countInput]").val(), 
                "min_count": 1, 
                "networks": [{"uuid": $("select[name=networkSelect]").val()}]
            }}
            
        $.ajax({
            type: "POST",
            headers: {"X-Auth-Token" : token,
                      "Content-Type": "application/json",
                      Accept:"application/json"},
            url: API_URL+"/v2.1/servers",
            data: JSON.stringify(data),
            success: function(response) {
                if(!alert("已送出")){window.location.reload();}
            },
            error: function(xhr, status, error) {
                alert(xhr.responseText);
            },
        })
    }

</script>
<script>
var loginuser = localStorage.getItem("username");
document.getElementById("loginuser").innerHTML = loginuser;
</script>

</body>
</html>
